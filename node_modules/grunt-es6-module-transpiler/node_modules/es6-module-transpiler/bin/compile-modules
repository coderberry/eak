#!/usr/bin/env node
"use strict";
var $__getDescriptors = function(object) {
  var descriptors = {}, name, names = Object.getOwnPropertyNames(object);
  for (var i = 0; i < names.length; i++) {
    var name = names[i];
    descriptors[name] = Object.getOwnPropertyDescriptor(object, name);
  }
  return descriptors;
}, $__createClassNoExtends = function(object, staticObject) {
  var ctor = object.constructor;
  Object.defineProperty(object, 'constructor', {enumerable: false});
  ctor.prototype = object;
  Object.defineProperties(ctor, $__getDescriptors(staticObject));
  return ctor;
};
var optimist = require("optimist");
var fs = require("fs");
var path = require("path");
var through = require("through");
function extend(target) {
  for (var sources = [], $__1 = 1; $__1 < arguments.length; $__1++) sources[$__1 - 1] = arguments[$__1];
  var toString = {}.toString;
  sources.forEach(function(source) {
    for (var key in source) {
      target[key] = source[key];
    }
  });
  return target;
}
var CLI = function() {
  'use strict';
  var $CLI = ($__createClassNoExtends)({
    constructor: function(Compiler) {
      var stdin = arguments[1] !== (void 0) ? arguments[1]: process.stdin;
      var stdout = arguments[2] !== (void 0) ? arguments[2]: process.stdout;
      var fs_ = arguments[3] !== (void 0) ? arguments[3]: fs;
      this.Compiler = Compiler;
      this.stdin = stdin;
      this.stdout = stdout;
      this.fs = fs_;
    },
    start: function(argv) {
      var options = this.parseArgs(argv);
      if (options.help) {
        this.argParser(argv).showHelp();
      } else if (options.stdio) {
        this.processStdio(options);
      } else {
        for (var i = 2; i < options._.length; i++) {
          var filename = options._[i];
          this.processPath(filename, options);
        }
      }
    },
    parseArgs: function(argv) {
      var args = this.argParser(argv).argv;
      if (args.imports) {
        var imports = {};
        args.imports.split(',').forEach(function(pair) {
          var $__2 = pair.split(':'), requirePath = $__2[0], global = $__2[1];
          imports[requirePath] = global;
        });
        args.imports = imports;
      }
      if (args.global) {
        args.into = args.global;
      }
      return args;
    },
    argParser: function(argv) {
      return optimist(argv).usage('compile-modules usage:\n\n  Using files:\n    compile-modules INPUT --to DIR [--anonymous] [--type TYPE] [--imports PATH:GLOBAL]\n\n  Using stdio:\n    compile-modules --stdio [--type TYPE] [--imports PATH:GLOBAL] (--module-name MOD|--anonymous)').options({
        type: {
          "default": 'amd',
          describe: 'The type of output (one of "amd", "cjs", or "globals")'
        },
        to: {describe: 'A directory in which to write the resulting files'},
        imports: {describe: 'A list of path:global pairs, comma separated (e.g. jquery:$,ember:Ember)'},
        anonymous: {
          "default": false,
          type: 'boolean',
          describe: 'Do not include a module name'
        },
        'module-name': {
          describe: 'The name of the outputted module',
          alias: 'm'
        },
        stdio: {
          "default": false,
          type: 'boolean',
          alias: 's',
          describe: 'Use stdin and stdout to process a file'
        },
        global: {describe: 'When the type is `globals`, the name of the global to export into'},
        help: {
          "default": false,
          type: 'boolean',
          alias: 'h',
          describe: 'Shows this help message'
        }
      }).check((function($__2) {
        var type = $__2.type;
        return type === 'amd' || type === 'cjs' || type === 'globals';
      })).check((function(args) {
        return !args.anonymous || !args.m;
      })).check((function(args) {
        return (args.stdio && args.type === 'amd') ? args.anonymous || args.m || false: true;
      })).check((function(args) {
        return args.stdio || args.to || args.help;
      })).check((function(args) {
        return args.imports ? args.type === 'globals': args.type !== 'globals';
      }));
    },
    processStdio: function(options) {
      this.processIO(this.stdin, this.stdout, options);
    },
    processIO: function(input, output, options) {
      try {
        throw undefined;
      } catch (end) {
        try {
          throw undefined;
        } catch (write) {
          var data = '', self = this;
          write = function(chunk) {
            data += chunk;
          };
          end = function() {
            this.queue(self._compile(data, options.m, options.type, options));
            this.queue(null);
          };
          input.pipe(through(write, end)).pipe(output);
        }
      }
    },
    processPath: function(filename, options) {
      this.fs.stat(filename, function(err, stat) {
        if (err) {
          throw new Error(err);
        } else if (stat.isDirectory()) {
          this.processDirectory(filename, options);
        } else {
          this.processFile(filename, options);
        }
      }.bind(this));
    },
    processDirectory: function(dirname, options) {
      this.fs.readdir(dirname, function(err, children) {
        if (err) {
          console.error(err.message);
          process.exit(1);
        }
        children.forEach(function(child) {
          this.processPath(path.join(dirname, child), options);
        }.bind(this));
      }.bind(this));
    },
    processFile: function(filename, options) {
      try {
        throw undefined;
      } catch (normalizePath) {
        normalizePath = function(p) {
          return p.replace(/\\/g, '/');
        };
        var ext = path.extname(filename), basenameNoExt = path.basename(filename, ext), dirname = path.dirname(filename), pathNoExt = normalizePath(path.join(dirname, basenameNoExt)), output, outputFilename = normalizePath(path.join(options.to, filename)), moduleName = options.anonymous ? null: pathNoExt;
        options = extend({}, options, {m: moduleName});
        this._mkdirp(path.dirname(outputFilename));
        this.processIO(this.fs.createReadStream(filename), this.fs.createWriteStream(outputFilename), options);
      }
    },
    _compile: function(input, moduleName, type, options) {
      var compiler, method;
      type = {
        amd: 'AMD',
        cjs: 'CJS',
        globals: 'Globals'
      }[type];
      compiler = new this.Compiler(input, moduleName, options);
      method = "to" + type;
      return compiler[method]();
    },
    _mkdirp: function(directory) {
      var prefix;
      if (this.fs.existsSync(directory)) {
        return;
      }
      prefix = path.dirname(directory);
      if (prefix !== '.' && prefix !== '/') {
        this._mkdirp(prefix);
      }
      return this.fs.mkdirSync(directory);
    }
  }, {});
  return $CLI;
}();
CLI.start = function(Compiler, argv) {
  var stdin = arguments[2] !== (void 0) ? arguments[2]: process.stdin;
  var stdout = arguments[3] !== (void 0) ? arguments[3]: process.stdout;
  var fs_ = arguments[4] !== (void 0) ? arguments[4]: fs;
  return new CLI(Compiler, stdin, stdout, fs_).start(argv);
};
var fs = require('fs'), path = require('path');
function requireMain() {
  var root = path.join(__dirname, '..'), pkgPath = path.join(root, 'package.json'), pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf8'));
  return require(path.join(root, pkg.main));
}
var Compiler = requireMain().Compiler;
CLI.start(Compiler, process.argv);

//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG1wL3RyYW5zcGlsZWQvY29tcGlsZS1tb2R1bGVzLmpzLmVzNiIsInNvdXJjZXMiOlsidG1wL3RyYW5zcGlsZWQvY29tcGlsZS1tb2R1bGVzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQUE7dUJDQUEsU0FBQSxDQUFTLE1BQUEsQ0FBUTtBQUNMLEtBQUEsWUFBQSxFQUFjLEVBQUEsQ0FBQSxDQUFJLEtBQUEsQ0FBTSxNQUFBLEVBQVEsT0FBQSxDQUFBLG1CQUEwQixDQUFDLE1BQUEsQ0FBQTtBQUMvRCxLQUFBLEVBQVMsR0FBQSxFQUFBLEVBQUksRUFBQSxDQUFHLEVBQUEsRUFBSSxNQUFBLENBQUEsTUFBQSxDQUFjLEVBQUEsRUFBQSxDQUFLO0FBQ2pDLE9BQUEsS0FBQSxFQUFPLE1BQUEsQ0FBTSxDQUFBLENBQUE7QUFDakIsZUFBQSxDQUFZLElBQUEsQ0FBQSxFQUFRLE9BQUEsQ0FBQSx3QkFBK0IsQ0FBQyxNQUFBLENBQVEsS0FBQSxDQUFBO0FBQUE7QUFFOUQsUUFBTyxZQUFBO0FBQUEsQ0FBQSwyQkNOZixTQUFBLENBQVMsTUFBQSxDQUFRLGFBQUEsQ0FBYztBQUNyQixLQUFBLEtBQUEsRUFBTyxPQUFBLENBQUEsV0FBQTtBQUNYLFFBQUEsQ0FBQSxjQUFxQixDQUFDLE1BQUEsQ0FBUSxjQUFBLENBQWUsRUFBQyxVQUFBLENBQVksTUFBQSxDQUFBLENBQUE7QUFDMUQsTUFBQSxDQUFBLFNBQUEsRUFBaUIsT0FBQTtBQUNqQixRQUFBLENBQUEsZ0JBQXVCLENBQUMsSUFBQSxDQUFNLGtCQUFpQixDQUFDLFlBQUEsQ0FBQSxDQUFBO0FBQ2hELFFBQU8sS0FBQTtBQUFBLENBQUE7QUZKVCxHQUFBLFNBQUEsRUFBVyxRQUFPLENBQUMsVUFBQSxDQUFBO0FBQ25CLEdBQUEsR0FBQSxFQUFLLFFBQU8sQ0FBQyxJQUFBLENBQUE7QUFDYixHQUFBLEtBQUEsRUFBTyxRQUFPLENBQUMsTUFBQSxDQUFBO0FBQ2YsR0FBQSxRQUFBLEVBQVUsUUFB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QUEsQ0FBQSxLQUFTLENBQUMsUUFBQSxDQUFVLFFBQUEsQ0FBQSxJQUFBLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbnZhciBvcHRpbWlzdCA9IHJlcXVpcmUoXCJvcHRpbWlzdFwiKTtcbnZhciBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcbnZhciBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XG52YXIgdGhyb3VnaCA9IHJlcXVpcmUoXCJ0aHJvdWdoXCIpO1xuXG5mdW5jdGlvbiBleHRlbmQodGFyZ2V0LCAuLi5zb3VyY2VzKSB7XG4gIHZhciB0b1N0cmluZyA9IHt9LnRvU3RyaW5nO1xuXG4gIHNvdXJjZXMuZm9yRWFjaChmdW5jdGlvbihzb3VyY2UpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7XG4gICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHRhcmdldDtcbn1cblxuY2xhc3MgQ0xJIHtcbiAgY29uc3RydWN0b3IoQ29tcGlsZXIsIHN0ZGluPXByb2Nlc3Muc3RkaW4sIHN0ZG91dD1wcm9jZXNzLnN0ZG91dCwgZnNfPWZzKSB7XG4gICAgdGhpcy5Db21waWxlciA9IENvbXBpbGVyO1xuICAgIHRoaXMuc3RkaW4gPSBzdGRpbjtcbiAgICB0aGlzLnN0ZG91dCA9IHN0ZG91dDtcbiAgICB0aGlzLmZzID0gZnNfO1xuICB9XG5cbiAgc3RhcnQoYXJndikge1xuICAgIHZhciBvcHRpb25zID0gdGhpcy5wYXJzZUFyZ3MoYXJndik7XG5cbiAgICBpZiAob3B0aW9ucy5oZWxwKSB7XG4gICAgICB0aGlzLmFyZ1BhcnNlcihhcmd2KS5zaG93SGVscCgpO1xuICAgIH0gZWxzZSBpZiAob3B0aW9ucy5zdGRpbykge1xuICAgICAgdGhpcy5wcm9jZXNzU3RkaW8ob3B0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAodmFyIGkgPSAyOyBpIDwgb3B0aW9ucy5fLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBmaWxlbmFtZSA9IG9wdGlvbnMuX1tpXTtcbiAgICAgICAgdGhpcy5wcm9jZXNzUGF0aChmaWxlbmFtZSwgb3B0aW9ucyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcGFyc2VBcmdzKGFyZ3YpIHtcbiAgICB2YXIgYXJncyA9IHRoaXMuYXJnUGFyc2VyKGFyZ3YpLmFyZ3Y7XG5cbiAgICBpZiAoYXJncy5pbXBvcnRzKSB7XG4gICAgICB2YXIgaW1wb3J0cyA9IHt9O1xuICAgICAgYXJncy5pbXBvcnRzLnNwbGl0KCcsJykuZm9yRWFjaChmdW5jdGlvbihwYWlyKSB7XG4gICAgICAgIHZhciBbcmVxdWlyZVBhdGgsIGdsb2JhbF0gPSBwYWlyLnNwbGl0KCc6Jyk7XG4gICAgICAgIGltcG9ydHNbcmVxdWlyZVBhdGhdID0gZ2xvYmFsO1xuICAgICAgfSk7XG4gICAgICBhcmdzLmltcG9ydHMgPSBpbXBvcnRzO1xuICAgIH1cblxuICAgIGlmIChhcmdzLmdsb2JhbCkge1xuICAgICAgYXJncy5pbnRvID0gYXJncy5nbG9iYWw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFyZ3M7XG4gIH1cblxuICBhcmdQYXJzZXIoYXJndikge1xuICAgIHJldHVybiBvcHRpbWlzdChhcmd2KS51c2FnZSgnY29tcGlsZS1tb2R1bGVzIHVzYWdlOlxcblxcbiAgVXNpbmcgZmlsZXM6XFxuICAgIGNvbXBpbGUtbW9kdWxlcyBJTlBVVCAtLXRvIERJUiBbLS1hbm9ueW1vdXNdIFstLXR5cGUgVFlQRV0gWy0taW1wb3J0cyBQQVRIOkdMT0JBTF1cXG5cXG4gIFVzaW5nIHN0ZGlvOlxcbiAgICBjb21waWxlLW1vZHVsZXMgLS1zdGRpbyBbLS10eXBlIFRZUEVdIFstLWltcG9ydHMgUEFUSDpHTE9CQUxdICgtLW1vZHVsZS1uYW1lIE1PRHwtLWFub255bW91cyknKS5vcHRpb25zKHtcbiAgICAgIHR5cGU6IHtcbiAgICAgICAgXCJkZWZhdWx0XCI6ICdhbWQnLFxuICAgICAgICBkZXNjcmliZTogJ1RoZSB0eXBlIG9mIG91dHB1dCAob25lIG9mIFwiYW1kXCIsIFwiY2pzXCIsIG9yIFwiZ2xvYmFsc1wiKSdcbiAgICAgIH0sXG4gICAgICB0bzoge1xuICAgICAgICBkZXNjcmliZTogJ0EgZGlyZWN0b3J5IGluIHdoaWNoIHRvIHdyaXRlIHRoZSByZXN1bHRpbmcgZmlsZXMnXG4gICAgICB9LFxuICAgICAgaW1wb3J0czoge1xuICAgICAgICBkZXNjcmliZTogJ0EgbGlzdCBvZiBwYXRoOmdsb2JhbCBwYWlycywgY29tbWEgc2VwYXJhdGVkIChlLmcuIGpxdWVyeTokLGVtYmVyOkVtYmVyKSdcbiAgICAgIH0sXG4gICAgICBhbm9ueW1vdXM6IHtcbiAgICAgICAgXCJkZWZhdWx0XCI6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGRlc2NyaWJlOiAnRG8gbm90IGluY2x1ZGUgYSBtb2R1bGUgbmFtZSdcbiAgICAgIH0sXG4gICAgICAnbW9kdWxlLW5hbWUnOiB7XG4gICAgICAgIGRlc2NyaWJlOiAnVGhlIG5hbWUgb2YgdGhlIG91dHB1dHRlZCBtb2R1bGUnLFxuICAgICAgICBhbGlhczogJ20nXG4gICAgICB9LFxuICAgICAgc3RkaW86IHtcbiAgICAgICAgXCJkZWZhdWx0XCI6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFsaWFzOiAncycsXG4gICAgICAgIGRlc2NyaWJlOiAnVXNlIHN0ZGluIGFuZCBzdGRvdXQgdG8gcHJvY2VzcyBhIGZpbGUnXG4gICAgICB9LFxuICAgICAgZ2xvYmFsOiB7XG4gICAgICAgIGRlc2NyaWJlOiAnV2hlbiB0aGUgdHlwZSBpcyBgZ2xvYmFsc2AsIHRoZSBuYW1lIG9mIHRoZSBnbG9iYWwgdG8gZXhwb3J0IGludG8nXG4gICAgICB9LFxuICAgICAgaGVscDoge1xuICAgICAgICBcImRlZmF1bHRcIjogZmFsc2UsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgYWxpYXM6ICdoJyxcbiAgICAgICAgZGVzY3JpYmU6ICdTaG93cyB0aGlzIGhlbHAgbWVzc2FnZSdcbiAgICAgIH1cbiAgICB9KS5jaGVjaygoe3R5cGV9KSA9PiB0eXBlID09PSAnYW1kJyB8fCB0eXBlID09PSAnY2pzJyB8fCB0eXBlID09PSAnZ2xvYmFscycpXG4gICAgLmNoZWNrKGFyZ3MgPT4gIWFyZ3MuYW5vbnltb3VzIHx8ICFhcmdzLm0pXG4gICAgLmNoZWNrKGFyZ3MgPT4gKGFyZ3Muc3RkaW8gJiYgYXJncy50eXBlID09PSAnYW1kJykgPyBhcmdzLmFub255bW91cyB8fCBhcmdzLm0gfHwgZmFsc2UgOiB0cnVlKVxuICAgIC5jaGVjayhhcmdzID0+IGFyZ3Muc3RkaW8gfHwgYXJncy50byB8fCBhcmdzLmhlbHApXG4gICAgLmNoZWNrKGFyZ3MgPT4gYXJncy5pbXBvcnRzID8gYXJncy50eXBlID09PSAnZ2xvYmFscycgOiBhcmdzLnR5cGUgIT09ICdnbG9iYWxzJyk7XG4gIH1cblxuICBwcm9jZXNzU3RkaW8ob3B0aW9ucykge1xuICAgIHRoaXMucHJvY2Vzc0lPKHRoaXMuc3RkaW4sIHRoaXMuc3Rkb3V0LCBvcHRpb25zKTtcbiAgfVxuXG4gIHByb2Nlc3NJTyhpbnB1dCwgb3V0cHV0LCBvcHRpb25zKSB7XG4gICAgdmFyIGRhdGEgPSAnJyxcbiAgICAgICAgc2VsZiA9IHRoaXM7XG5cbiAgICBmdW5jdGlvbiB3cml0ZShjaHVuaykge1xuICAgICAgZGF0YSArPSBjaHVuaztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlbmQoKSB7XG4gICAgICAvKiBqc2hpbnQgLVcwNDAgKi9cbiAgICAgIHRoaXMucXVldWUoc2VsZi5fY29tcGlsZShkYXRhLCBvcHRpb25zLm0sIG9wdGlvbnMudHlwZSwgb3B0aW9ucykpO1xuICAgICAgdGhpcy5xdWV1ZShudWxsKTtcbiAgICB9XG5cbiAgICBpbnB1dC5waXBlKHRocm91Z2god3JpdGUsIGVuZCkpLnBpcGUob3V0cHV0KTtcbiAgfVxuXG4gIHByb2Nlc3NQYXRoKGZpbGVuYW1lLCBvcHRpb25zKSB7XG4gICAgdGhpcy5mcy5zdGF0KGZpbGVuYW1lLCBmdW5jdGlvbihlcnIsIHN0YXQpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycik7XG4gICAgICB9IGVsc2UgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICB0aGlzLnByb2Nlc3NEaXJlY3RvcnkoZmlsZW5hbWUsIG9wdGlvbnMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wcm9jZXNzRmlsZShmaWxlbmFtZSwgb3B0aW9ucyk7XG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIHByb2Nlc3NEaXJlY3RvcnkoZGlybmFtZSwgb3B0aW9ucykge1xuICAgIHRoaXMuZnMucmVhZGRpcihkaXJuYW1lLCBmdW5jdGlvbihlcnIsIGNoaWxkcmVuKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UpO1xuICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICB9XG4gICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICAgIHRoaXMucHJvY2Vzc1BhdGgocGF0aC5qb2luKGRpcm5hbWUsIGNoaWxkKSwgb3B0aW9ucyk7XG4gICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0uYmluZCh0aGlzKSk7XG4gIH1cblxuICBwcm9jZXNzRmlsZShmaWxlbmFtZSwgb3B0aW9ucykge1xuICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZVBhdGgocCkge1xuICAgICAgcmV0dXJuIHAucmVwbGFjZSgvXFxcXC9nLCAnLycpO1xuICAgIH1cblxuICAgIHZhciBleHQgICAgICAgICAgICA9IHBhdGguZXh0bmFtZShmaWxlbmFtZSksXG4gICAgICAgIGJhc2VuYW1lTm9FeHQgID0gcGF0aC5iYXNlbmFtZShmaWxlbmFtZSwgZXh0KSxcbiAgICAgICAgZGlybmFtZSAgICAgICAgPSBwYXRoLmRpcm5hbWUoZmlsZW5hbWUpLFxuICAgICAgICBwYXRoTm9FeHQgICAgICA9IG5vcm1hbGl6ZVBhdGgocGF0aC5qb2luKGRpcm5hbWUsIGJhc2VuYW1lTm9FeHQpKSxcbiAgICAgICAgb3V0cHV0LFxuICAgICAgICBvdXRwdXRGaWxlbmFtZSA9IG5vcm1hbGl6ZVBhdGgocGF0aC5qb2luKG9wdGlvbnMudG8sIGZpbGVuYW1lKSksXG4gICAgICAgIG1vZHVsZU5hbWUgICAgID0gb3B0aW9ucy5hbm9ueW1vdXMgPyBudWxsIDogcGF0aE5vRXh0O1xuXG4gICAgb3B0aW9ucyA9IGV4dGVuZCh7fSwgb3B0aW9ucywge206IG1vZHVsZU5hbWV9KTtcbiAgICB0aGlzLl9ta2RpcnAocGF0aC5kaXJuYW1lKG91dHB1dEZpbGVuYW1lKSk7XG5cbiAgICB0aGlzLnByb2Nlc3NJTyhcbiAgICAgIHRoaXMuZnMuY3JlYXRlUmVhZFN0cmVhbShmaWxlbmFtZSksXG4gICAgICB0aGlzLmZzLmNyZWF0ZVdyaXRlU3RyZWFtKG91dHB1dEZpbGVuYW1lKSxcbiAgICAgIG9wdGlvbnNcbiAgICApO1xuICB9XG5cbiAgX2NvbXBpbGUoaW5wdXQsIG1vZHVsZU5hbWUsIHR5cGUsIG9wdGlvbnMpIHtcbiAgICB2YXIgY29tcGlsZXIsIG1ldGhvZDtcbiAgICB0eXBlID0ge1xuICAgICAgYW1kOiAnQU1EJyxcbiAgICAgIGNqczogJ0NKUycsXG4gICAgICBnbG9iYWxzOiAnR2xvYmFscydcbiAgICB9W3R5cGVdO1xuICAgIGNvbXBpbGVyID0gbmV3IHRoaXMuQ29tcGlsZXIoaW5wdXQsIG1vZHVsZU5hbWUsIG9wdGlvbnMpO1xuICAgIG1ldGhvZCA9IFwidG9cIiArIHR5cGU7XG4gICAgcmV0dXJuIGNvbXBpbGVyW21ldGhvZF0oKTtcbiAgfVxuXG4gIF9ta2RpcnAoZGlyZWN0b3J5KSB7XG4gICAgdmFyIHByZWZpeDtcbiAgICBpZiAodGhpcy5mcy5leGlzdHNTeW5jKGRpcmVjdG9yeSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcHJlZml4ID0gcGF0aC5kaXJuYW1lKGRpcmVjdG9yeSk7XG4gICAgaWYgKHByZWZpeCAhPT0gJy4nICYmIHByZWZpeCAhPT0gJy8nKSB7XG4gICAgICB0aGlzLl9ta2RpcnAocHJlZml4KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZnMubWtkaXJTeW5jKGRpcmVjdG9yeSk7XG4gIH1cbn1cblxuQ0xJLnN0YXJ0ID0gZnVuY3Rpb24oQ29tcGlsZXIsIGFyZ3YsIHN0ZGluPXByb2Nlc3Muc3RkaW4sIHN0ZG91dD1wcm9jZXNzLnN0ZG91dCwgZnNfPWZzKSB7XG4gIHJldHVybiBuZXcgQ0xJKENvbXBpbGVyLCBzdGRpbiwgc3Rkb3V0LCBmc18pLnN0YXJ0KGFyZ3YpO1xufTtcblxubGV0IGZzICAgPSByZXF1aXJlKCdmcycpLFxuICAgIHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5cbmZ1bmN0aW9uIHJlcXVpcmVNYWluKCkge1xuICB2YXIgcm9vdCAgICA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLicpLFxuICAgICAgcGtnUGF0aCA9IHBhdGguam9pbihyb290LCAncGFja2FnZS5qc29uJyksXG4gICAgICBwa2cgICAgID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMocGtnUGF0aCwgJ3V0ZjgnKSk7XG5cbiAgcmV0dXJuIHJlcXVpcmUocGF0aC5qb2luKHJvb3QsIHBrZy5tYWluKSk7XG59XG5cbmxldCBDb21waWxlciA9IHJlcXVpcmVNYWluKCkuQ29tcGlsZXI7XG5cbkNMSS5zdGFydChDb21waWxlciwgcHJvY2Vzcy5hcmd2KTtcbiJdfQ==